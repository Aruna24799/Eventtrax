<!DOCTYPE html>
<html>
<head>
<title>Eventtrax</title>
</head>

<body>

<h2>Admin</h2>
<input id="eventName" placeholder="Event name">
<button onclick="createEvent()">Create Event</button>

<hr>

<h2>Events</h2>
<div id="events"></div>

<hr>

<h2>Join Event</h2>
<input id="participantName" placeholder="Your name">
<button onclick="joinEvent()">Join</button>

<canvas id="qr"></canvas>

<script type="module">

import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
import QRCode from "https://cdn.jsdelivr.net/npm/qrcode/+esm";

const supabase = createClient(
  "https://pxtpsugbuunjzurdvzkc.supabase.co",
  "sb_publishable_BOHqCxkzsVWChq-zAc4Q3Q_ED0khzHW"
);

let currentEvent=null;

window.createEvent = async()=>{

 const name=document.getElementById("eventName").value;

 const {data,error}=await supabase.from("events").insert([{name}]).select();

 if(error){alert(error.message);return;}

 currentEvent=data[0].id;

 loadEvents();
 drawQR();
};

async function loadEvents(){

 const {data}=await supabase.from("events").select("*");

 const box=document.getElementById("events");
 box.innerHTML="";

 data.forEach(e=>{
   box.innerHTML+=`<p>${e.name}</p>`;
   currentEvent=e.id;
 });

}

window.joinEvent=async()=>{

 const name=document.getElementById("participantName").value;

 const {error}=await supabase.from("participants").insert([
  {name,event_id:currentEvent}
 ]);

 if(error) alert(error.message);
 else alert("Joined");

};

async function drawQR(){
 await QRCode.toCanvas(document.getElementById("qr"),
   window.location.href
 );
}

loadEvents();

</script>

</body>
</html>
